<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Eye Tracker</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin-top: 2rem;
    }
    #status {
      margin-top: 1rem;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Eye Tracking Active</h1>
  <p>Make sure to allow camera access in your browser</p>
  <p id="status">Waiting for connection...</p>

  
  <script src="https://api.gazerecorder.com/GazeCloudAPI.js"></script>

  <script>
    
    const ws = new WebSocket('ws://localhost:8765');

    ws.onopen = () => {
      document.getElementById('status').textContent = "Connected to VS Code extension ✅";
      console.log('Connected to VS Code extension');
    };

    ws.onclose = () => {
      document.getElementById('status').textContent = "Disconnected ❌";
      console.log('Disconnected from VS Code extension');
    };

    ws.onerror = (err) => {
      console.error('WebSocket error:', err);
      document.getElementById('status').textContent = "Error ⚠️";
    };

    
    GazeCloudAPI.StartEyeTracking();

    
    GazeCloudAPI.OnResult = function(GazeData) {
      console.log('Gaze Data:', GazeData); // Debug log

      if (GazeData.state === 0 && ws.readyState === WebSocket.OPEN) {
        ws.send(JSON.stringify({
          x: GazeData.docX,
          y: GazeData.docY,
          time: GazeData.time
        }));
      }
    };

    
    GazeCloudAPI.OnCalibrationComplete = () => {
      console.log('Calibration complete!');
    };

    GazeCloudAPI.OnCamDenied = () => {
      alert('Camera access denied! Please enable it.');
    };

    GazeCloudAPI.OnError = (msg) => {
      console.error('EyeTracker Error:', msg);
    };
  </script>
</body>
</html>
