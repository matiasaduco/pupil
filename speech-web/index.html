<!doctype html>
<html lang="es">
	<head>
		<meta charset="UTF-8" />
		<title>Speech Recognition Demo</title>
		<style>
			body {
				font-family: sans-serif;
				margin: 2em;
			}
			#result {
				margin-top: 1em;
				font-size: 1.2em;
			}
			button {
				padding: 0.5em 1em;
				font-size: 1em;
			}
		</style>
	</head>
	<body>
		<h1>Demo SpeechRecognition</h1>
		<button id="start">Iniciar reconocimiento</button>
		<div id="result" />
		<script>
			const startBtn = document.getElementById('start')
			const resultDiv = document.getElementById('result')
			const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition
			const ws = new WebSocket('ws://localhost:8080')
			let recognition

			if (!SpeechRecognition) {
				resultDiv.textContent = 'Tu navegador no soporta SpeechRecognition.'
			} else {
				recognition = new SpeechRecognition()
				recognition.continuous = true
				recognition.lang = 'es-ES'

				recognition.onresult = (event) => {
					const transcript = (resultDiv.textContent = event.results[0][0].transcript)

					if (ws.readyState === WebSocket.OPEN) {
						ws.send({ type: 'transcript', content: transcript })
					}
				}

				recognition.onerror = (event) => {
					resultDiv.textContent = 'Error: ' + event.error
				}

				startBtn.onclick = () => {
					recognition.start()
					resultDiv.textContent = 'Escuchando...'
				}
			}

			ws.onmessage = (event) => {
				const message = JSON.parse(event.data)

				if (message.type === 'start-listening') {
					recognition.start()
					resultDiv.textContent = 'Escuchando...'
				}

				if (message.type === 'stop-listening') {
					recognition.stop()
					resultDiv.textContent = 'Reconocimiento detenido.'
				}
			}

			ws.onopen = () => {
				console.log('Conected to WebSocket')
			}

			ws.onclose = () => {
				console.log('WebSocket closed')
			}

			ws.onerror = (error) => {
				console.error('WebSocket error:', error)
			}
		</script>
	</body>
</html>
